#!/bin/sh -e

regex='^reede\?$'

if [ -n "$CONFIG" ]
then
    echo "$regex"
    exit
fi

__kas_on() {
    if [ -n "$1" ]
    then d="$1"
    else d=today
    fi
    date -d "$d" '+%d%m' | grep -Eq "$2"
}

__on_lyhendatud() {
    __kas_on "$1" '2302|2206|2312|3112'
}

__on_riigipyha() {
    __sr=x # TODO: suur reede
    __yp=x # TODO: ülestõusmispühade 1. püha
    __kas_on "$1" "0101|2402|$__sr|$__yp|0105|2306|2406|2008|2412|2512|2612"
}

__d="$( date '+%u' )"

if __on_riigipyha
then
    if __on_riigipyha 'tomorrow' || [ "$__d" = '6' ] || [ "$__d" = '7' ]
    then echo 'Homme on ka vaba... kasi tagasi jooma!'
    else
        case "$( date -d 'tomorrow' '+%u' )" in
            1|2|3) echo 'Hakkame lõpetama...' ;;
            4)     echo 'Hakkame lõpetama, kuid homme on juba varareede!' ;;
            5)     echo 'Hakkame lõpetama, kuid homme on jälle reede!!!' ;;
        esac
    fi
elif __on_riigipyha 'tomorrow'
then
    if [ "$__d" = '7' ]
    then echo 'Homme on riigipüha, kasi tagasi jooma!'
    else echo 'Jah, homme on riigipüha!'
    fi
elif __on_lyhendatud
then echo 'Jah, lühendatud ka veel!'
elif [ "$__d" = '4' ]
then echo 'Varareede alles.'
elif __on_lyhendatud 'tomorrow' || __on_riigipyha '2 days'
then echo '"Varareede" alles.'
elif [ "$__d" = '3' ]
then echo 'Kolmapäev, aga mõned ju võiks...'
elif [ "$__d" = '5' ]
then echo 'JAH!!!'
elif [ "$__d" = '6' ]
then echo 'Nädalavahetus on, kasi tagasi jooma!'
elif [ "$__d" = '7' ]
then echo 'Hakkame lõpetama...'
else echo 'Ei.'
fi
